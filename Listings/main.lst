C51 COMPILER V9.60.0.0   MAIN                                                              11/06/2023 23:06:51 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\WorkSoftware\Keil5_C51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\code) DEBUG OBJE
                    -CTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /*
   2          program versions : 2.6
   3          
   4          增加lcd1602 光标移动
   5          It already works in this version;
   6          
   7          modification: 2023/11/5 21:11
   8          
   9          modifier: Cameron Bright
  10          
  11          */
  12          
  13          #include "main.h"
  14          #include "LCD1602.h"  //包含LCD1602头文件
  15          #include "Key.h"      //按键扫描函数
  16          
  17          sbit V0 = P1^2;
  18          
  19          sbit K1 = P3^7;//继电器 低电平闭合
  20          sbit K2 = P3^6;
  21          sbit K3 = P3^5;
  22          sbit K4 = P3^4;
  23          
  24          sbit Buzzer = P2^3;//蜂鸣器 低电平工作
  25          
  26          void Timer0_Init(void); //1毫秒@11.0592MHz
  27          
  28          void Key_Proc(void);    //Keystroke process function
  29          void Lcd_Proc(void);    //LCD Dsiplay process function
  30          
  31          unsigned int timer_tick = 0;
  32          unsigned int buzzer_tick = 0;//用于开机计数500ms
  33          
  34          unsigned char key_value; //按键处理变量
  35          unsigned char key_down;
  36          unsigned char key_up;
  37          unsigned char key_old;
  38          
  39          unsigned int key_tick; //long key press count
  40          
  41          unsigned char page = 0;//lcd 显示界面
  42          unsigned char cursor = 5;
  43          
  44          unsigned int key_slow_down = 0;
  45          unsigned int lcd_slow_down = 0;
  46          
  47          unsigned int dispbuf = 0;
  48          
  49          unsigned char password[6] = {'0','0','0','0','0','0'};
  50          
  51          void main()
  52          {
  53   1        Timer0_Init();//定时器初始化
  54   1        
C51 COMPILER V9.60.0.0   MAIN                                                              11/06/2023 23:06:51 PAGE 2   

  55   1        //Buzzer = 0;
  56   1        LCD_Init();
  57   1        K2 = 0;
  58   1        
  59   1        EA = 1;
  60   1        
  61   1        while(1)
  62   1        { 
  63   2          Key_Proc();
  64   2          Lcd_Proc();
  65   2        }
  66   1        
  67   1      }
  68          
  69          void Lcd_Proc(void)     //LCD Dsiplay process function
  70          {
  71   1        if(lcd_slow_down) return;   //10ms更新一次
  72   1          lcd_slow_down = 1;
  73   1        
  74   1        if(page == 0)
  75   1        {
  76   2          LCD_WriteCommand(0x0C);//关光标
  77   2          
  78   2          LCD_ShowString(2,1,"Hello!");
  79   2        
  80   2          LCD_ShowNum(1,1,dispbuf,4);
  81   2          LCD_ShowNum(1,8,key_tick,4);
  82   2        }
  83   1        else if(page == 1)
  84   1        {
  85   2          LCD_WriteCommand(0x0f);//开光标
  86   2          LCD_ShowString(1,2,"Input Password");
  87   2          LCD_ShowString(2,6,password);
  88   2        }
  89   1        
  90   1        //LCD_WriteCommand(0x80+cursor); //第一行光标
  91   1        LCD_WriteCommand(0xc0+cursor); //第二行光标 
  92   1        
  93   1      }
  94          
  95          void Key_Proc(void)
  96          {
  97   1        if(key_slow_down) return;   //10ms更新一次
  98   1          key_slow_down = 1;
  99   1        
 100   1        key_value = Key_Read();
 101   1        key_down = key_value & (key_value ^ key_old);
 102   1        key_up = ~key_value & (key_value ^ key_old);
 103   1        key_old = key_value;
 104   1      
 105   1        if(key_down)       //长按五秒
 106   1          key_tick = 2000;
 107   1        
 108   1        if(key_old)
 109   1        {
 110   2          if(key_tick == 0)
 111   2            {
 112   3              Lcd_Clear();
 113   3              page = 1;
 114   3            }
 115   2        }
 116   1        
C51 COMPILER V9.60.0.0   MAIN                                                              11/06/2023 23:06:51 PAGE 3   

 117   1        switch(key_up)
 118   1        {
 119   2          case 1:
 120   2          {
 121   3            LED1 = 1;
 122   3            break;
 123   3          }
 124   2          case 2: 
 125   2          {
 126   3            password[cursor-5] += 1;
 127   3            if(password[cursor-5] > '9')
 128   3              password[cursor-5] = '9';
 129   3          
 130   3            key_tick = 0;
 131   3            break;
 132   3          }
 133   2          case 3:
 134   2          {
 135   3            password[cursor-5] -= 1;
 136   3      //      if(password[cursor-5] < 0)
 137   3      //        password[cursor-5] = 0;
 138   3            
 139   3            key_tick = 0;
 140   3            break;
 141   3          }
 142   2          case 4:
 143   2          {
 144   3            if(--cursor <= 5)
 145   3              cursor = 5;
 146   3            key_tick = 0;
 147   3            break;
 148   3          }
 149   2          case 5:
 150   2          {
 151   3            if(++cursor >= 10)
 152   3              cursor = 10;
 153   3            key_tick = 0;
 154   3            break;
 155   3          }
 156   2          case 6:
 157   2          {
 158   3            LED1 ^= 1;
 159   3            break;
 160   3          }
 161   2          default:
 162   2            break;
 163   2        }   
 164   1      }
 165          
 166          void Timer0_Isr(void) interrupt 1
 167          {
 168   1        if(++key_slow_down == 10) key_slow_down = 0;
 169   1        if(++lcd_slow_down == 300) lcd_slow_down = 0;
 170   1        
 171   1        if(key_tick > 0) key_tick--;
 172   1        
 173   1      //  if(Buzzer == 0)
 174   1      //  {
 175   1      //    if(++buzzer_tick >= 500)
 176   1      //      {
 177   1      //        Buzzer = 1;
 178   1      //        buzzer_tick = 0;
C51 COMPILER V9.60.0.0   MAIN                                                              11/06/2023 23:06:51 PAGE 4   

 179   1      //      }
 180   1      //  }
 181   1        
 182   1        
 183   1              
 184   1      //  TL0 = 0x20;       //设置定时初始值
 185   1      //  TH0 = 0xD1;       //设置定时初始值
 186   1          
 187   1      }
 188          
 189          void Timer0_Init(void)    //1毫秒@11.0592MHz
 190          {
 191   1        AUXR |= 0x80;     //定时器时钟1T模式
 192   1        TMOD &= 0xF0;     //设置定时器模式
 193   1        TL0 = 0xCD;       //设置定时初始值
 194   1        TH0 = 0xD4;       //设置定时初始值
 195   1        TF0 = 0;        //清除TF0标志
 196   1        TR0 = 1;        //定时器0开始计时
 197   1        ET0 = 1;        //使能定时器0中断
 198   1      }
 199          
 200           


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    395    ----
   CONSTANT SIZE    =     22    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     24    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
